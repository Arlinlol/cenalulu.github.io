---
layout: article
title:  "十分钟搞清字符集和字符编码"
categories: linux
toc: true
ads: true
#image:
#    teaser: /teaser/default.jpg
---

> 本文将简述字符集，字符编码的概念。以及在遭遇乱码时的一些常用诊断技巧

> 背景：字符集和编码无疑是IT菜鸟甚至是各种大神的头痛问题。当遇到纷繁复杂的字符集，各种火星文和乱码时，问题的定位往往变得非常困难。本文就将会从原理方面对字符集和编码做个简单的科普介绍，同时也会介绍一些通用的乱码故障定位的方法以方便读者以后能够更从容的定位相关问题。在正式介绍之前，先做个小申明：如果你希望非常精确的理解各个名词的解释，那么可以查阅wikipedia。本文是博主通过自己理解消化后并转化成易懂浅显的表述后的介绍。


---


## 什么是字符集

在介绍字符集之前，我们先了解下为什么要有字符集。我们在计算机屏幕上看到的是实体化的文字，而在计算机存储介质中存放的实际是二进制的比特流。那么在这两者之间的转换规则就需要一个统一的标准，否则把我们的U盘查到老板的电脑上文档就乱码了，小伙伴QQ上传过来的文件在我们本地打开又乱码了。(PS：这里科普下`乱码`的英文native说法是`mojibake`）。于是为了实现转换标准，各种字符集标准就出现了。简单的说字符集就规定了某个文字对应的二进制数字存放方式（编码）和某串二进制数值代表了哪个文字（解码）的转换关系。
那么为什么会有那么多字符集标准呢？这个问题实际非常容易回答。问问自己为什么我们的插头拿到英国就不能用了呢？为什么显示器同时有DVI，VGA，HDMI，DP这么多接口呢？很多规范和标准在最初制定时并不会意识到这将会是以后全球普适的准则，或者处于组织本身利益就想从本质上区别于现有标准。于是，就产生了那么多具有相同效果但又不相互兼容的标准了。
说了那么多我们来看一个实际例子，下面就是`屌`这个字在各种编码下的十六进制和二进制编码结果，怎么样有没有一种很屌的感觉？

字符集|16进制编码|对应的二进制数据
|-|-|
UTF-8|0xE5B18C|111001011011000110001100
UTF-16|0x5C4C|101110001001100
GBK|0x8CC5|1000110011000101


---


## 什么是字符编码

字符集只是一个规则集合的名字，对应到真实生活中，字符集就是对某种语言的称呼。例如：英语，汉语，日语。而如何用英语来表达`你狠屌`的意思就是英语词法语法所需要具体描述的内容了。而对于一个字符集来说要正确编码转码一个字符需要三个关键元素：字库表（character repertoire）、编码字符集（coded character set）、字符编码（character encoding form）。其中字库表是一个相当于所有可读或者可显示字符的数据库，字库表决定了整个字符集能够展现表示的所有字符的范围。编码字符集，即用一个编码值`code point`来表示一个字符在字库中的位置。字符编码，将编码字符集和实际存储数值之间的转换关系。一般来说都会直接将`code point`的值作为编码后的值直接存储。例如在ASCII中`A`在表中排第65位，而编码后`A`的数值是`0100 0001`也即十进制的65的二进制转换结果。


---


## 为什么会出现乱码

简单的说乱码的出现是因为：编码和解码时用了不同或者不兼容的字符集。对应到真实生活中，就好比是一个英国人为了表示祝福在纸上写了`bless`（编码过程）。而一个法国人拿到了这张纸，认为他想表达的是`受伤`（在法语中bless表示受伤的意思）-解码过程。这个就是一个现实生活中的乱码情况。在计算机科学中一样，一个用UTF8编码后的字符，用GBK去解码。由于两个字符集的字库表不一样，同一个汉字在两个字符表的位置也不同，最终就会出现乱码。
我们来看一个例子：假设我们用UTF8编码存储`很屌`两个字，会有如下转换：

字符|UTF8编码后的十六进制
|-|-|
很|E5BE88
屌|E5B18C

于是我们得到了`E5BE88E5B18C`这么一串数值。而显示时我们用GBK解码进行展示，通过查表我们获得以下信息：

两个字节的十六进制数值|GBK解码后对应的字符
|-|-|
E5BE|寰
88E5|堝
B18C|睂

解码后我们就得到了`寰堝睂`这么一个错误的结果，更要命的是连字符个数都变了。









## UTF8和Unicode的关系



## 如何尝试辨别乱码的字符集




### reference
[如何配置Python默认字符集]({{ site.url }}/python/python-encoding)
[字符编码笔记：ASCII，Unicode和UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
[Unicode中文编码表](http://www.chi2ko.com/tool/CJK.htm)

